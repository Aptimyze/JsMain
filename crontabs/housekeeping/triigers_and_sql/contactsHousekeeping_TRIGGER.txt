DELIMITER |
DELIMITER ;


1.CONTACTS

(a)Insert

CREATE TRIGGER CONTACTS_TRIGGER_I AFTER INSERT ON CONTACTS
FOR EACH ROW
BEGIN
INSERT IGNORE INTO test.CONTACTS_ACTIVE values(NEW.CONTACTID,NEW.SENDER,NEW.RECEIVER,NEW.TYPE,NEW.TIME,NEW.COUNT,NEW.MSG_DEL,NEW.SEEN,NEW.FILTERED,NEW.FOLDER);
END; |


(b)Update

CREATE TRIGGER CONTACTS_TRIGGER_U AFTER UPDATE ON CONTACTS
FOR EACH ROW
BEGIN
REPLACE INTO test.CONTACTS_ACTIVE values(NEW.CONTACTID,NEW.SENDER,NEW.RECEIVER,NEW.TYPE,NEW.TIME,NEW.COUNT,NEW.MSG_DEL,NEW.SEEN,NEW.FILTERED,NEW.FOLDER);
IF OLD.TIME<'2010-02-20' THEN
REPLACE INTO test.CONTACTS6_MONTHS_OLD_RECORD VALUES(NEW.SENDER,NEW.RECEIVER);
REPLACE INTO test.MESSAGE_LOG_ACTIVE SELECT * FROM MESSAGE_LOG WHERE SENDER=NEW.SENDER AND RECEIVER=NEW.RECEIVER;
REPLACE INTO test.MESSAGE_LOG_ACTIVE SELECT * FROM MESSAGE_LOG WHERE SENDER=NEW.RECEIVER AND RECEIVER=NEW.SENDER;
REPLACE INTO test.MESSAGES_ACTIVE SELECT A.ID, MESSAGE FROM MESSAGE_LOG A, MESSAGES B WHERE SENDER =NEW.SENDER AND RECEIVER =NEW.RECEIVER AND A.ID=B.ID;
REPLACE INTO test.MESSAGES_ACTIVE SELECT A.ID, MESSAGE FROM MESSAGE_LOG A, MESSAGES B WHERE SENDER=NEW.RECEIVER AND RECEIVER=NEW.SENDER AND A.ID=B.ID;
REPLACE INTO test.EOI_VIEWED_LOG_ACTIVE SELECT * FROM EOI_VIEWED_LOG WHERE VIEWER=NEW.RECEIVER AND VIEWED=NEW.SENDER;
REPLACE INTO test.EOI_VIEWED_LOG_ACTIVE SELECT * FROM EOI_VIEWED_LOG WHERE VIEWER=NEW.SENDER AND VIEWED=NEW.RECEIVER;
END IF;
END; |



(c)Delete

CREATE TRIGGER CONTACTS_TRIGGER_D AFTER DELETE ON CONTACTS
FOR EACH ROW
BEGIN
DELETE FROM test.CONTACTS_ACTIVE WHERE CONTACTID=OLD.CONTACTID;
END; |

